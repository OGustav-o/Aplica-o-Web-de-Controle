-- USERS
CREATE TABLE USERS (
  ID            NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  USERNAME      VARCHAR2(150) UNIQUE NOT NULL,
  PASSWORD_HASH VARCHAR2(255) NOT NULL,
  ENABLED       NUMBER(1) DEFAULT 1 NOT NULL,
  CREATED_AT    TIMESTAMP DEFAULT SYSTIMESTAMP
);

-- ROLES
CREATE TABLE ROLES (
  ID    NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  NAME  VARCHAR2(100) UNIQUE NOT NULL
);

-- USER_ROLES (N:N)
CREATE TABLE USER_ROLES (
  USER_ID NUMBER NOT NULL REFERENCES USERS(ID),
  ROLE_ID NUMBER NOT NULL REFERENCES ROLES(ID),
  CONSTRAINT PK_USER_ROLES PRIMARY KEY (USER_ID, ROLE_ID)
);

-- REFRESH TOKENS
CREATE TABLE REFRESH_TOKENS (
  ID            NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  USER_ID       NUMBER NOT NULL REFERENCES USERS(ID),
  TOKEN         VARCHAR2(600) NOT NULL,
  EXPIRES_AT    TIMESTAMP NOT NULL,
  REVOKED       NUMBER(1) DEFAULT 0 NOT NULL,
  CREATED_AT    TIMESTAMP DEFAULT SYSTIMESTAMP
);

-- Domínio de exemplo: ITEMS
CREATE TABLE ITEMS (
  ID          NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  NAME        VARCHAR2(200) NOT NULL,
  DESCRIPTION VARCHAR2(1000),
  CREATED_BY  NUMBER REFERENCES USERS(ID),
  CREATED_AT  TIMESTAMP DEFAULT SYSTIMESTAMP
);

-- Seeds básicos
INSERT INTO ROLES(NAME) VALUES ('ROLE_ADMIN');
INSERT INTO ROLES(NAME) VALUES ('ROLE_USER');
COMMIT;
